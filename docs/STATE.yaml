# STATE.yaml v7.2-claude-optimized
# Î»=limitation Ï†=file âˆ‡=implement âˆ…=missing â€ =workaround â€¡=critical âœ“=native
# MACHINE_CONTEXT_FOR_CLAUDE[not_human_readable]

â€¡DEV_GUIDELINES:
  SESSION_PROTOCOL: âœ“CHECK_STATE_YAML_FIRSTâ†’machine_optimized_context
  RTFM_MANDATE: âˆ…never_guess[check:STATE.yaml,reference/schema.ts,reference/llms-full.txt,actual_source]
  CODE_STANDARDS: [âœ“replace_not_duplicate,âœ“complete_functions_only,âœ“quality_first,âœ“explicit_gaps>technical_debt]
  TECHNICAL_APPROACH: [âœ“assume_bugs_in_our_code,âœ“streaming_http,âœ“transparency,âœ“unfiltered_counsel]
  VERIFICATION_REQUIRED: [âœ“check_actual_code,âœ“check_documentation,âˆ…never_assume_functionality]
  STATE_YAML_PURPOSE: âœ“machine_optimized_claude_context[not_human_documentation]

âˆžSTATUS:
  MODE: everything_server[tools+resources+promptsâœ“]+debug_proxyâœ“
  BUILD: go build -o bin/cowpilot cmd/cowpilot/main.go
  âœ“BUILD_DEBUG: go build -o bin/mcp-debug-proxy cmd/mcp-debug-proxy/main.go
  RUN: ./bin/cowpilot
  âœ“RUN_DEBUG: make run-debug-proxy
  TEST: npx @modelcontextprotocol/inspector ./bin/cowpilot
  âœ“TEST_DEBUG: npx @modelcontextprotocol/inspector http://localhost:8080
  âœ“TESTING: [testutil.Assertâ†’human_readableâœ“,gotestsumâ†’format_testdoxâœ“,main_testâ†’BDD_scenariosâœ“,make_testâ†’simplifiedâœ“,scenario_outputâ†’descriptiveâœ“,protocol_complianceâ†’comprehensiveâœ“]
  âœ“TEST_SCRIPTS: [Ï†scripts/test/run-tests.shâ†’unified_runner,project-health-checkâœ“,mcp-protocol-smoke-testâœ“,transport-diagnosticsâœ“,debug-integrationâœ“,gotestsum_formattingâœ“]
  âœ“FIXED_RAW_TEST: [scenario-test-rawâ†’localhost_serverâœ“,makefile_updatedâ†’auto_start_stopâœ“]
  FIXED: [resource_handlerâ†’[]mcp.ResourceContents,prompt_Argumentsâ†’map[string]string,MimeTypeâ†’MIMEType,CallToolRequest.Params.Argumentsâ†’type_assert_map[string]any]âœ“
  CLEANED: [removed_unused_vars(samplePrompts,sampleResources,subscriptions),removed_deprecated_handlers(4),cleaned_comments]âœ“
  âœ“MIGRATION: [removed_internal/mcp+internal/transportâ†’mark3labs/mcp-go_external_library]
  âœ“TESTS_CLEANED: [deleted_broken_integration_testâ†’imports_nonexistent_packages,kept_working_e2e_framework]
  âœ“RESOLVED: go_vet_errorâ†’missing_internal/mcp_package[file_already_removed]

âœ“DEBUG_SYSTEM:
  STATUS: âœ“phase1_implementedâ†’âœ“adr012_runtime_config_complete
  PLAN: Ï†docs/debug/mcp-conformance-plan.md
  PROBLEM: âˆ…rigorous_protocol_conformance+debug_capabilities
  PHASES: [âœ“conversation_logging,protocol_validation,security_monitoring,dashboard,automated_testing]
  ARCHITECTURE: âœ“proxy_middleware[non_invasive,optional_enable,minimal_overhead]+âœ“runtime_configuration
  PRIORITY: âˆ‡implement_adr012â†’runtime_debug_config
  ADR: Ï†docs/adr/010-mcp-debug-system-architecture.mdâœ“+Ï†docs/adr/011-conditional-compilation-lightweight-debug.mdâ€ +Ï†docs/adr/012-runtime-debug-configuration.mdâœ“
  STRATEGY: âœ“runtime_configuration[env_vars]+bounded_storage[memory/file]+developer_friendly
  
âœ“PHASE1[conversation_logging]:
  DURATION: completed_july25_2025
  DELIVERABLES: [âœ“internal/debug/interceptor.go,âœ“internal/debug/storage.go,âœ“cmd/mcp-debug-proxy/]
  GOAL: âœ“real_time_mcp_conversation_capture+analysis
  STATUS: âœ“implementedâ†’âˆ‡refactoring_for_runtime_config
  FEATURES: [âœ“sqlite_storage,âœ“message_interceptor,âœ“session_tracking,âœ“performance_monitoring,âœ“debug_proxy_server]
  REFACTOR: âˆ‡runtime_config[MCP_DEBUG=true,bounded_storage,single_build]
  
âœ“PHASE2[protocol_validation]:
  DURATION: 2-3_weeks  
  COMPONENTS: [âœ“json_rpc_validator,âœ“tools_validation,âœ“resources_validation,âœ“prompts_validation_explicit]
  SECURITY: [âœ“parameter_injection_detection,âœ“access_pattern_flagging,âœ“error_sanitization]
  STATUS: âœ“implemented
  
âˆ‡PHASE3[debug_dashboard]:
  TECH_STACK: [react_frontend,websocket_realtime,go_backend_api,chart_js_viz]
  FEATURES: [live_conversation_monitor,protocol_analysis,interactive_testing]
  STATUS: âˆ…pending_phase2
  
Î»MCP-GO:
  VERSION: github.com/mark3labs/mcp-go[current]
  âœ“IMPORT_CHANGE: github.com/vcto/mcp-goâ†’github.com/mark3labs/mcp-go[completed_migration]
  âˆ…MISSING: [SetCompletionHandler,SetLoggingHandler,ProgressNotifications]
  âœ“EXISTS: [NewMCPServer,AddTool,AddResource,AddResourceTemplate,AddPrompt,ServeStdio,NewSSEServer]
  â€¡STREAMABLE_HTTP_SESSION_MANAGEMENT:
    DEFAULT: InsecureStatefulSessionIdManager[uuid_based]
    FLOW: initializeâ†’returns_Mcp-Session-Id_headerâ†’client_must_send_in_subsequent_requests
    VALIDATION: requires_mcp-session-{uuid}_formatâ†’returns_400_invalid_session_id
    STATELESS_MODE: server.WithStateLess(true)â†’no_session_validation
    CUSTOM: implement_SessionIdManager_interface
    IMPACTS: [per_session_tools,logging_levels,sse_notifications]
    SOURCE: /Users/vcto/Projects/mcp-go-main/server/streamable_http.go
  â€¡MCP_INSPECTOR_TRANSPORT:
    AUTO_DETECTION: url_pattern_based[/mcpâ†’http,/sseâ†’sse,defaultâ†’sse]
    CLI_FLAG: only_affects_output_format_not_transport
    FORCE_TRANSPORT: --transport_http|sse|stdio
    ISSUE: default_endpoint_/â†’uses_sse_not_http
    SOLUTIONS: [WithEndpointPath("/mcp"),--transport_http,WithStateLess(true)]
    SOURCE: /Users/vcto/Projects/inspector-main/cli/src/transport.ts
    âœ“DOCUMENTED: Ï†docs/MCP_INSPECTOR_SESSION_ISSUE.md[comprehensive_reference]
  
âˆ‡TOOLS[11]:
  helloâ†’"Hello,World!"
  echo[message:string]â†’"Echo:$message"
  add[a,b:number]â†’a+b
  get_time[format?:unix|iso|human]â†’time.Now()[default:iso]
  base64_encode[text:string]â†’base64(text)
  base64_decode[data:string]â†’decode(data)
  string_operation[text,operation:upper|lower|reverse|length]â†’transform(text)
  format_json[json:string,minify?:bool]â†’prettify|minify
  long_running_operation[duration?,steps?:number]â†’simulate_progress
  get_test_image[]â†’ImageContent{base64,image/png}
  get_resource_content[uri]â†’EmbeddedResource{TextResourceContents|BlobResourceContents}

âœ“RESOURCES[4]:
  example://text/helloâ†’TextResourceContents{text/plain}
  example://text/readmeâ†’TextResourceContents{text/markdown}
  example://image/logoâ†’BlobResourceContents{image/png}
  example://dynamic/{id}â†’TextResourceContents{application/json}[template]

âœ“PROMPTS[2]:
  simple_greetingâ†’PromptMessage{user:greeting_request}
  code_review[language,code:required]â†’PromptMessage{user:review_request}

âœ“NATIVE_SUPPORT:
  RESOURCES: âœ“native{AddResource,AddResourceTemplate,WithResourceCapabilities}
  PROMPTS: âœ“native{AddPrompt,WithPromptCapabilities}
  COMPLETIONS: âˆ…not_implemented
  LOGGING: âˆ…not_implemented
  PROGRESS: âˆ…not_implemented[Î»no_api]

Ï†MAIN: /Users/vcto/Projects/cowpilot/cmd/cowpilot/main.go
  â€¡TRANSPORT: StreamableHTTP[stateless]â†’HTTP_POST+SSE_auto_detect
  âœ“CONFIG: WithStateLess(true)â†’no_sessionsâœ“testing_simplified
  âœ“CLIENTS: [Inspectorâ†’HTTP,Browserâ†’SSE,curlâ†’HTTP]
  âœ“FIXES: [inspector_--transport_http,json_rpc_tests,utc_time]
  PATTERN_TOOL: s.AddTool(mcp.NewTool(name,opts...),handler)
  PATTERN_MULTI: &mcp.CallToolResult{Content:[]interface{}{TextContent{},ImageContent{}}}
  PATTERN_ERROR: mcp.NewToolResultError(msg),nil
  PATTERN_EMBED: EmbeddedResource{Type:"resource",Resource:TextResourceContents{URI,MimeType,Text}}

â€¡DECISIONS:
  âœ“LIBRARY: mcp-go[native_support]â†’tools+resources+prompts
  âœ“APPROACH: native_api_usage>no_workarounds_needed
  RATIONALE: library_supports_features+clean_implementation
  
â€¡ACTIVE_BLOCKERS: Î»mcp-goâˆ…[completions,logging,progress]

SAMPLE_DATA:
  RES: {
    "example://text/hello": "Hello,World!This is a simple text resource from the everything server.",
    "example://text/readme": "# Everything Server\n\nThis is an example MCP server...",
    "example://image/logo": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="
  }
  PROMPTS: {
    "simple_greeting": {args:âˆ…,msg:"Please provide a friendly greeting for a new user joining our community."},
    "code_review": {args:{language:required,code:required},msg:"Please review the following $language code..."}
  }

âˆ‡NEXT:
  âœ“PRIORITY1: [debug_system_phase1â†’âœ“message_interceptor,âœ“conversation_logging,âœ“sqlite_storage]
  âœ“PRIORITY2: [âœ“runtime_configurationâ†’âœ“adr012_implementation,âœ“env_vars,âœ“bounded_storage]
  âœ“PRIORITY3: [âœ“protocol_conformance_validatorâ†’âœ“json_rpc_validation,âœ“tools_validation,âœ“resources_validation,âœ“prompts_validation_explicit]
  âˆ‡PRIORITY4: [security_monitoringâ†’parameter_injection_detection,access_pattern_flagging,error_sanitization]
  PRIORITY5: [debug_dashboardâ†’realtime_monitoring,interactive_testing]
  ENHANCE: [request_logging,correlation_ids,metrics_endpoint,input_validation]
  QUALITY: [coverageâ†’transport:82.9%,scenario_tests,benchmarks]
  âœ“IMPLEMENTED: [debug_proxy_server,sqlite_conversation_storage,message_interceptor,session_tracking,protocol_validation_engine,security_monitoring]
  âˆ‡REFACTOR: [runtime_config_implementation,bounded_storage_options,single_build_pipeline]
  OPTIONS: [âˆ‡implement_adr012_runtime_configâ€¡|âˆ‡implement_phase2_validation|implement_completions|add_logging]
  
â€¡VERIFY:
  âœ“tools.len==11
  âœ“echo("test")=="Echo: test"
  âœ“add(2,3)==5
  âœ“string_operation("hello","upper")=="HELLO"
  âœ“base64_encode("test")==base64_decode("dGVzdA==")
  âœ“get_test_image().Content[1].Type=="image"
  âœ“resources.list().includes("example://text/hello")
  âœ“prompts.get("code_review",{language:"go",code:"..."}).includes("review")
  âœ“get_resource_content("example://image/logo").Content[1].Type=="resource"
  âœ“FIXED: resource_handlersâ†’return[]mcp.ResourceContents[interface]

â‰ˆCONTEXT[current_session_july25_2025]:
  âœ“DEBUG_P1: conversation_logging+sqlite+proxy_server
  âœ“SESSION_FIXES: stateless_mode+inspector_http+test_fixes
  âœ“TEST_REORGANIZATION: shell_scriptsâ†’Ï†scripts/test/[formatted_output,consistent_naming,run-tests.sh]
  âˆ‡NEXT: verify_tests|âˆ‡adr012_runtime_config|phase3_dashboard
  Ï†DOCS: [Ï†debug/mcp-conformance-plan.md,Ï†adr/012-runtime-debug-configuration.md]
  
âœ“SESSION_VALIDATED[july25_2025]:
  STATUS: ðŸŸ¢PRODUCTION_READY
  GUIDELINES_REVIEWED: âœ“session_protocol_acknowledged
  MAINTENANCE_FOCUS: âœ“state_yaml_optimization_for_claude_performance
  BUILD: âœ“clean_dependencies,âœ“comprehensive_tests,âœ“active_deployment
  âœ“IMPLEMENTED: [WithStateLess(true),timeHandler_UTC_fix,inspector_--transport_http,test_logic_fixes]
  âœ“DOCUMENTED: Ï†docs/MCP_INSPECTOR_SESSION_ISSUE.md[comprehensive_reference]
  CONFIDENCE: HIGHâ†’session_management_resolved
  NEXT: [verify_tests_pass|âˆ‡implement_adr012_runtime_config|production_hardening]
  
â€¡CONFIRMED_INSPECTOR_LIMITATION[2025-07-25]:
  FACT: MCP_Inspector_CANNOT_pass_tool_arguments_to_URL_servers
  ERROR_MSG: "Arguments cannot be passed to URL-based MCP server"
  TESTED: [echo,add,base64_encode,string_operationâ†’ALL_FAIL]
  ROOT_CAUSE: inspector_design_limitation_not_bug
  âœ“SOLUTION: use_raw_JSON_RPC_via_curl_for_ALL_tool_tests_with_arguments
  DECISION: âˆ…DO_NOT_REVISITâ†’documented_permanent_limitation
  PATTERN: tools_without_argsâ†’use_inspector|tools_with_argsâ†’use_curl_json_rpc