# STATE.yaml v8.0-claude-optimized
# λ=limitation φ=file ∇=implement ∅=missing †=workaround ‡=critical ✓=working
# MACHINE_CONTEXT_FOR_CLAUDE[accurate_current_state]

‡CURRENT_ARCHITECTURE[2025-07-29]:
  STATUS: ✓production_multi_server_system[PATHS_UPDATED]
  PRIMARY_SERVERS:
    demo: φcmd/demo-server/main.go→comprehensive_demo_server[port_8080]
    rtm: φcmd/rtm_server/main.go→RTM_focused_server[port_8081]→✓DEPLOYED
    spektrix: φcmd/spektrix_server/main.go→Spektrix_integration[port_TBD]
    test_examples: φcmd/test-examples-server/main.go→testing_examples[port_8082]
    debug_proxy: φcmd/mcp_debug_proxy/main.go→debug_system
    oauth_spec_test: φcmd/oauth_spec_test/main.go→claude_ai_oauth_spec_compliance_test[port_8090]
  DEPLOYMENT: ✓fly.io[app:cowpilot,port:8081,RTM_production]
  BUILD_SYSTEM: ✓Makefile[comprehensive_testing,multi_target,FIXED_PATHS]

✓RTM_PRODUCTION_STATUS[2025-07-29]:
  STATUS: ✓deployed_and_functional
  APP_NAME: cowpilot[fly.io]
  ENDPOINT: https://cowpilot.fly.dev/mcp
  PORT: 8081[production]
  STORAGE: ✓persistent_sqlite[/data/tokens.db,cowpilot_data_volume]
  AUTH_FLOW: ✓OAuth_implemented[RTM_API_integration]
  CAPABILITIES: [8_RTM_tools,7_RTM_resources,debug_system]
  HEALTH_CHECK: ✓/health[15s_intervals]

✓RTM_TOOLS[8_implemented]:
  rtm_auth_url→generate_authentication_url
  rtm_lists→get_all_lists_with_metadata  
  rtm_search→search_tasks_with_RTM_syntax
  rtm_quick_add→create_task_smart_syntax
  rtm_update→modify_task_properties
  rtm_complete→mark_tasks_complete
  rtm_manage_list→create_rename_archive_lists
  CREDENTIALS: env[RTM_API_KEY,RTM_API_SECRET]

✓RTM_RESOURCES[7_implemented]:
  rtm://today→tasks_due_today_json
  rtm://inbox→inbox_tasks_json
  rtm://overdue→past_due_tasks_json  
  rtm://week→next_7_days_tasks_json
  rtm://lists→all_lists_with_counts_json
  rtm://lists/{list_name}→specific_list_tasks[template]
  rtm://smart/{list_name}→smart_list_tasks[template]

✓DEBUG_SYSTEM[comprehensive]:
  STATUS: ✓implemented_runtime_configurable
  CONFIG: env[MCP_DEBUG_ENABLED,MCP_DEBUG_LEVEL]
  STORAGE: ✓sqlite[debug_conversations.db]
  FEATURES: [request_logging,protocol_validation,performance_monitoring]
  MIDDLEWARE: ✓zero_overhead_when_disabled

λMCP_GO_LIMITATIONS[current]:
  VERSION: github.com/mark3labs/mcp-go@v0.34.1
  ∅MISSING: [completions,logging_api,progress_notifications]
  ✓AVAILABLE: [tools,resources,prompts,StreamableHTTP,stateless_mode]
  WORKAROUNDS: [server_side_logging,context_cancellation,rich_responses]

‡MCP_OAUTH_SPEC_EVOLUTION[CRITICAL_2025-07-29]:
  STATUS: λOUR_ARCHITECTURE_MAY_BE_DEPRECATED
  ANTHROPIC_ACKNOWLEDGMENT: "got_OAuth_wrong"_in_march_2025_spec
  
  ‡SPEC_TIMELINE:
    MARCH_2025: ❌MCP_server_as_auth_server_AND_resource_server
    JUNE_18_2025: ✓separation_of_concerns→auth_server_separate_from_resource_server
    
  ‡CURRENT_COWPILOT_PATTERN[potentially_deprecated]:
    STATUS: †following_march_2025_pattern
    ROLE: φoauth_adapter.go→acting_as_authorization_server_AND_resource_server
    ENDPOINTS: [/oauth/authorize,/oauth/token,/mcp]→dual_responsibility
    PROBLEM: complex_frob_to_oauth_conversion_in_single_server
    
  ‡NEW_SPEC_REQUIREMENTS[june_18_2025]:
    MCP_SERVER_ROLE: resource_server_ONLY→validate_tokens_serve_tools_resources
    AUTH_SERVER_ROLE: separate_entity→handle_user_login_issue_tokens
    DISCOVERY: RFC_9728→OAuth_2.0_Protected_Resource_Metadata
    SECURITY: RFC_8707→Resource_Indicators_mandatory_for_clients
    INTEGRATION: leverage_existing_identity_providers[Auth0,WorkOS,enterprise_SSO]
    
  ‡CLAUDE_AI_SUPPORT_STATUS[2025-07-29]:
    CLAUDE_WEB: ✓OAuth_support_confirmed→"worked_fine_a_month_ago"
    CLAUDE_CODE: ✓OAuth_support_added→"only_added_it_this_week"[june_2025]
    SPEC_COMPLIANCE: ✓expected_to_be_compliant_with_latest_spec
    UNCERTAINTY: λneed_to_test_actual_new_spec_features
    
  ∇CRITICAL_DECISION_POINT:
    OPTION_A: fix_current_auth_UX→maintain_deprecated_pattern
    OPTION_B: migrate_to_new_spec→future_proof_but_risk_breaking
    APPROACH: ∇TEST_CLAUDE_AI_NEW_SPEC_SUPPORT_FIRST

∇IMMEDIATE_TASKS[priority_order]:
  1. ∇MCP_OAUTH_SPEC_COMPLIANCE_TEST: bash_scripts/test-all-systems.sh→verify_all_systems_run_oauth_test
  2. ∇ICON_DISPLAY: investigate_claude_mcp_server_icon_requirements
  3. ∇RTM_AUTH_VERIFICATION: test_actual_oauth_flow_end_to_end  
  4. ∇PRODUCTION_MONITORING: health_checks_logs_metrics
  5. ∇USER_CREDENTIALS: allow_user_provided_RTM_keys_vs_server_env

✓COMPLETED_TASKS[2025-07-29]:
  1. ✓BUILD_TREE_INTEGRATION: docs-tree_target_exists_in_Makefile→generates_project_structure_md
  2. ✓NAMING_ANALYSIS: comprehensive_analysis_applied_to_Go_MD_SH_YAML_files→report_generated
  3. ✓FILE_REORGANIZATION: critical_medium_low_priority_renames→standardized_naming_conventions
  4. ✓MCP_OAUTH_SPEC_TEST_CREATED: φcmd/oauth_spec_test/→minimal_resource_server_claude_ai_compliance_test
  5. ✓MAKEFILE_PATH_UPDATES: fixed_help.mk→makefile_help.mk_and_directory_paths→build_system_working
  6. ✓PACKAGE_CONFLICT_RESOLVED: tests/integration/mcp_integration_test.go→package_tests_to_integration
  7. ✓IMPORT_PATH_FIXED: cmd/demo-server/main_test.go→internal/testing_to_testutil
  8. ✓MCP_API_TYPE_FIXED: cmd/oauth_spec_test/main.go→CallToolRequestParams_to_CallToolRequest
  9. ✓LINTER_ISSUES_RESOLVED: cmd/oauth_spec_test/main.go→errcheck_and_staticcheck_violations_fixed
  10. ✓INTEGRATION_TEST_PATH_FIXED: scripts/test/test-mcp-integration.sh→cmd/everything_to_demo-server
  11. ✓HEALTH_CHECK_PATHS_FIXED: scripts/test/project-health-check.sh→updated_all_directory_references

‡BUILD_AND_TEST[comprehensive]:
  BUILD: make build-rtm→builds_and_tests_before_deploy
  TEST_STRATEGY: [unit_tests,integration_local,integration_deployed,scenario_tests]
  TOOLS: ✓gotestsum[human_readable_output]
  CI: ✓comprehensive_validation_before_production

‡FILES_CRITICAL[claude_reference]:
  φcmd/demo-server/main.go→demo_server_all_capabilities
  φcmd/demo-server/main_test.go→[FIXED_IMPORT_PATH]
  φcmd/rtm_server/main.go→production_RTM_focused_server  
  φcmd/oauth_spec_test/→[main.go,run-test.sh,README.md]→claude_ai_oauth_spec_compliance_test[FIXED_API_AND_LINTER]
  φscripts/test-oauth-build.sh→oauth_test_build_and_run_script
  φscripts/test-makefile-and-oauth.sh→makefile_and_oauth_test_combined
  φscripts/test-all-fixes.sh→comprehensive_build_test_and_oauth_verification
  φscripts/test-final-fixes.sh→final_verification_script
  φscripts/test-linter-fixes.sh→linter_verification_and_oauth_test
  φscripts/test-integration-fix.sh→comprehensive_integration_and_oauth_test
  φscripts/test-all-systems.sh→final_comprehensive_verification_script
  φscripts/test/test-mcp-integration.sh→[FIXED_DEMO_SERVER_PATH]
  φscripts/test/project-health-check.sh→[FIXED_ALL_DIRECTORY_PATHS]
  φinternal/rtm/→[client.go,handlers.go,oauth_adapter.go,setup.go]
  φinternal/debug/→[interceptor.go,storage.go,config.go]
  φinternal/testutil/→[testing_utilities][RENAMED_FROM_testing]
  φtests/integration/→[all_files_package_integration][FIXED]
  φMakefile→comprehensive_build_test_deploy_system[FIXED_PATHS]
  φmakefile_help.mk→makefile_help_file[RENAMED]
  φfly.toml→production_deployment_config

∞SESSION_PROTOCOL:
  ✓CHECK_STATE_YAML_FIRST: machine_optimized_claude_context
  ✓RTFM_MANDATE: check_actual_code_not_assumptions  
  ✓QUALITY_FOCUS: complete_solutions_not_quick_fixes
  ✓CURRENT_BLOCKERS: understand_before_fixing

∞CURRENT_FOCUS:
  ISSUE: ∇oauth_spec_compliance_test_all_systems_verified
  CONTEXT: all_build_test_health_systems_fixed_and_functional
  GOAL: determine_claude_ai_mcp_oauth_spec_support_june_vs_march_2025
  APPROACH: run_comprehensive_verification→run_oauth_test→register_in_claude_ai→observe_behavior→make_architectural_decision
